# 5장 명령행 모드

## Tip.27 명령행과 만나기

명령행 모드는 Ex 명령, 검색 패턴, 표현식을 입력했을 때 활성화된다.

Vim에서 _:_를 누르면 명령행 모드로 전환된다.
명령 이름을 입력한 후 \<CR\>를 눌러 실행한다.
다시 일반 모드로 돌아가려면 \<Esc\>를 누른다.

명령행 모드에서 실행할 수 있는 명령을 Ex 명령이라고 부른다.
명령행 모드는 //를 눌러 검색 프롬프트(search prompt)를 불러오거나 \<C-r\>\=로 표현식 레지스터에 접근했을 때 활성화된다.

버퍼 문서 작업에 사용할 수 있는 Ex 명령

- `:[범위]delete [x]`: 지정한 행을 삭제 [레지스터 x에 저장]
- `:[범위]yank [x]`: 지정한 행을 복사 [레지스터 x에 저장]
- `:[범위]put [x]`: 지정한 행 뒤에 레지스터 x에 저장된 문서를 붙여넣기
- `:[범위]copy {주소}`: 지정한 복사해서 {주소} 행 아래에 붙여넣기
- `:[범위]move {주소}`: 지정한 행을 {주소} 행 아래로 이동하기
- `:[범위]normal [x]`: 지정한 행을 한 줄로 연결하기
- `:[범위]substitute/{패턴}/{문자열}/[플래그]`: 지정한 행에서 {패턴}이 나타나면 {문자열}로 치환
- `:[범위]global/{패턴}/[명령]`: Ex 명령인 [명령]을 지정한 모든 행 중 {패턴}이 나타나는 곳에서만 실행하기

__:edit__, __:write__, __:tabnew__, __:split__, __:prev__, __:next__, __:bprev__, __:bnext__

__:h ex-cmd-index__

Ex 명령은 대부분 범위 입력을 허용한다.

### Vim 명령행 모드에서의 특수키

명령행 모드는 마치 끼워넣기 모드처럼 키보드에 있는 문자 대부분을 그대로 입력할 수 있다.
끼워넣기 모드에서는 입력한 내용이 버퍼에 작성되지만 명령행 모드에서는 프롬프트에서 나타난다.
두 모드에서 전부 \<Ctrl\>과 조합해서 호출 명령으로 사용할 수 있다.

끼워넣기 모드와 명령행 모드는 몇 가지 명령을 공유하고 있다.
예를 들어 \<C-w\>와 \<C-u\>는 끼워넣기 모드와 명령행 모드에서 모두 지원한다.

- \<C-w\>는 이전 단어까지 역방향으로 지우는 기능이다.
- \<C-u\>는 행의 시작까지 역방향으로 지우는 기능이다.
- \<C-v\>와 \<C-k\> 명령은 키보드에 없는 문자를 삽입할 때 사용한다.
- \<C-r\>__{레지스터}__ 명령으로 내용이 어떤 레지스터에 저장되었든 상관없이 명령행에서 입력할 수 있다.

명령행 프롬프트에서는 이동할 수 있는 영역이 다소 제한적이다. \<left\>와 \<right\>방향키를 사용하면 각각 방향에 따라 한 글자씩 이동할 수 있다.
일반 모드에서는 커서를 움직이는 키를 다야하게 제공하기 때문에 명령행 프롬프트 대신에 명령행 창도 제공한다.

Vim의 명령행 창은 프롬프트에서 쓸 수 있는 명령을 조합해서 활용할 수 있는 창으로, 강력한 편집 기능을 제공한다.

### 어디에서나 광범위하게 활용할 수 있는 Ex 명령

Ex 명령은 대부분의 상황에서 범위를 지정해서 실행할 수 있고, 동작 한 번으로 여러 행을 동시에 수정할 수 있다. 그래서 Ex 명령은 일반 명령과 다르게 어디에서나 광범위한 영역에서 활용할 수 있다.

## Tip.28 연속된 행에 명령 실행하기

대부분의 Ex 명령은 __[범위]__를 지정해서 명령이 실행될 영역을 지정할 수 있다.
범위의 시작과 끝을 지정할 때는 행 번호, 마크(mark), 패턴을 이용할 수 있다.

Ex 명령의 강점 중 하나는 여러 범위의 행에서 동시에 실행할 수 있다는 점이다.

`cmdline-mode/practical-vim.html`

### 행 번호를 주소로 사용하기

입력한 Ex 명령이 숫자뿐이라면 Vim은 그 주소를 행 번호로 해석한 후, 커서를 그 특정 행으로 옮긴다.

`:1`, `:print`

파일의 최하단으로 이동하고 싶다면 특수기호인 __$__ 를 사용한다.

`:$`, `:p`

`:p`는 `:print`의 약식 표기다.

명령을 다음처럼 붙여서 입력해도 된다.

`:3p`

커서를 3번 행으로 이동한 다음에 그 행을 삭제하는 작업

- 명령행 모드, Ex 명령: `:3d`
- 일반모드:  `3G`, `dd`와 동일하다.

### 주소로 행 범위 지정하기

- `:2, 5p`: 2번 행부터 5번 행까지의 내용을 전부 출력한다. 이 명령을 실행한 후 커서는 5번행으로 이동한다.

범위는 일반적으로 다음 형태로 지정한다.

`:{시작},{끝}`

참고로 `{시작}`과 `{끝}` 모두 주소에 해당한다.

`.`기호도 주소로 사용할 수 있다. 이 기호를 범위에 사용하면 현재 커서가 놓인 행을 의미한다.

- `:2`: 2번 행으로 이동
- `:.,$p`: 현재 커서가 있는 행부터 파일 마지막까지 범위를 표현

`%` 기호는 현재 파일의 모든 행을 뜻한다. `:substitute` 명령과 조합해 매우 빈번하게 사용한다.

### 특정 영역을 비주얼 선택하기(visual selection)

숫자로 행의 범위를 지정하는 대신에 영역을 지정하는 비주얼 선택 기능을 사용할 수 있다.

`2G`, `VG` 명령을 실행하여 영역을 선택한 상태에서 `:`을 누르면 명령행 프롬프트에 `:<,'>`라는 범위가 미리 입력된 채로 나타난다. 이 기호는 방금 선택한 비주얼 선택의 범위를 의미한다. 이 선택 범위 기호 뒤에, 선택한 범위의 각 행에서 실행할 Ex 명령을 입력할 수 있다.

`'<`와 `'>` 표시는 각각 비주얼 선택 영역의 첫 행과 마지막 행을 의미한다.

일반ㄴ 모드에서 `:'<'>`를 사용한다면 마지막 비주얼 모드에서 선택했던 영역을 기준으로 동작한다.

### 영역을 패턴으로 지정하기

`:/<html>/,/<\/html>/p`

다른 범위 형식과 마찬가지로 `:{시작},{끝}`을 사용하고 있다.

`{시작}` 주소는 `/<html>/` 패턴과 일치하는 행이고, `{끝}` 주소는 `/<\/html>/`와 일치하는 행이다.

다시 말해, 앞서 지정한 범위는 `<html>` 태그가 열린 행부터 닫힌 행까지 해당한다.

### 오프셋으로 주소 수정하기

`<html></html>` 영역 내 모든 행에 대해서 Ex 명령을 실행할 때 `<html>`과 `</html>` 태그 자체는 영역에서 제외하고 싶다면 오프셋(offset)을 사용하면 된다.

`:/<html>/+1,/<\/html>-1p`

오프셋을 넣은 형태는 일반적으로 다음과 같다

`:{주소}+n`

n이 입력되지 않으면 기본 값으로 1이 적용된다. `{주소}`는 행 번호, 표시, 패턴을 사용할 수 있다.

현재 행에서 특정 행까지 명령을 실행하려는 경우, 다음과 같이 현재 행을 기준으로 상대적인 오프셋을 넣어 실행할 수 있다.

`:2`
`:.,.+3p`

`.`은 현재 행을 의미한다.

### 토론

Ex 명령에서 주소와 범위를 지정할 때 사용할 수 있는 기호 목록

- 1: 파일의 첫 행
- $: 파일의 마지막 행
- 0: 파일의 첫 행 위의 가상 행
  - `:copy`, `:move` 명령으로 범위를 파일의 최상단으로 복사하거나 이동하기 위한 인자로 많이 사용한다.
- .: 커서가 위치한 행
- 'm: 위치표시 m이 포함된 행
- '<: 비주얼 모드에서 선택된 영역의 첫 행
- '>: 비주얼 모드에서 선택된 영역의 마지막 행
- %: 파일 전체(`:1,$`의 축약형)

`{범위}`는 항상 연속하는 행을 표시한다. 하지만 `:global` 명령을 이용해 연속하지 않는 행에서 Ex 명령을 실행하는 것도 가능하다.

## Tip.29 :t와 :m 명령으로 행을 복제 또는 이동하기

__:copy__ 명령은 문서 한 부분에서 하나 이상의 행을 다른 위치에 복제할 때 사용 (짧은 표기로 __:t__)

__:move__은 하나 이상의 행을 다른 위치로 이동할 때 사용할 수 있다. (짧은 표기로 __:m__)

`cmdline-mode/shopping-list.todo`

### :t 명령으로 행 복제하기

`:&copy.`

- `:[범위]copy {주소}`
- `:h :copy`
- 축약
  - `:co`
  - `:t`: (copy TO)
- 예제
  - `:6t.`: 6번 행을 복사해서 현재 행 밑에 붙여넣기
  - `:t6`: 현재 행을 복사해서 6번 행 밑에 붙여넣기
  - `:t.`: 현재 행을 복사해서 붙여넣기(일반 모드의 yyp와 유사)
  - `:t$`: 현재 행을 파일의 마지막에 붙여넣기
  - `:'<,'>t0`: 비주얼 모드에서 선택한 행을 파일의 시작에 붙여넣기
  -기

`:t.` 명령은 레지스터를 사용하지 않고, 일반 모드의 `yyp`는 레지스터를 사용한다. 그래서 기본 레지스터에 저장된 내용을 지우지 않고 복사하고 싶을 때 `:t.` 명령을 사용한다.

행을 복사해서 붙여넣으려는 위치가 서로 멀리 떨어져 있다면 일반적으로 `yyp` 명령보다 `:t` 명령이 더 유용하다.

### :m 명령으로 행 이동하기

- `:move` 명령은 `:copy` 명령과 사용법이 유사하다.
- `:h :move` 참고
- `:[범위]move {주소}`
- 축약
  - `:m`
- 방법
  - 1. `Vjj`, `:'<,'>m$`
  - 2. `dGp` 

가장 마지막에 사용한 Ex 명령을 반복하려면 `@:`를 사용하면 된다.

## Tip.30 일반 모드 명령을 범위 대상으로 실행하기

연속한 행을 대상으로 일반 모드 명령을 사용하려면 `:normal` 명령을 활용하면 된다.

Tip.2의 각 행의 끝에 세미콜론을 붙이는 작업이 50회 반복해야 한다면 `j.`를 50번 눌러야 한다.

- `A;<Esc>`: 첫 행의 끝에 세미콜론 추가
- `jVG`: 2번째 행부터 마지막 행까지 비주얼 모드로 선택
- `:'<,'>normal .`: `:nomral` Ex 명령으로 점 명령을 실행할 범위를 지정해서 작업을 처리한다.

앞에서의 작업을 한 번의 명령으로 처리할 수 있다.

`:%normal A;`

- % 기호는 파일 전체 영역을 의미한다
- `:%normal A;` 를 사용하면 파일 전체 모든 행의 끝에 세미콜론을 붙이라는 명령을 내릴 수 있다.

`:normal`은 지정한 일반 모드 명령을 각각 행에서 실행하기 전에, 커서를 행의 시작점으로 옮긴다. 따라서 명령을 실행할 때, 커서의 위치를 신경 쓸 필요가 없다.

파일 전체에 주석 : `:normal i//`

`:normal`은 어떤 일반 명령과도 함께 사용할 수 있다. 특히 이 명령은 반복 명령과 조합해서 사용할 때 강력하다.

- `:normal .`
- `:normal @q`

## Tip.31 마지막 Ex audfud qksqhrgkrtl

- 점 명령: 가장 마지막에 실행한 일반 모드 명령 반복
- `@:`: 마지막 Ex 명령 반복

- `:bn[ext]`: 버퍼 목록에서 하나 앞 버퍼로 이동
- `:bp[revious]`: 버퍼 목록에서 하나 뒤 버퍼로 이동

버퍼 목록에 항목이 많아서 각각 항목을 살펴볼 때: `:bnext`

`:` 레지스터의 위치는 항상 가장 마지막에 실행했던 명령행이다. (`:h quote_:` 참고)

@:을 사용해서 저장된 매크로를 실행할 수 있다.
매크로를 반복하려면 @@ 명령을 사용할 수 있다.

@:을 필요 이상으로 많이 입력했을 때 되돌리려면

- `:bprevious` 명령으로 사용해서 이전 버퍼로 돌아간다.
  - 이 명령을 사용한 다음 @: 명령으로 다시 반복하면 `:bprevious`을 반복해서 실행된다.

이런 경우 `<C-o>` 명령을 사용하는 것이 바람직하다.
`:bnext` 명령은 매번 실행할 때마다(또는 @: 명령을 반복할 때 마다) 점프 목록에 이동한 기록이 남는다.
`<C-o>` 명령은 점프 목록에 기록된 이전 위치로 이동하는 기능을 한다.

`:bnext`를 한 번 실행한 후 `@:` 명령을 사용해서 반복할 수 있다. 이 반복을 되돌릴 필요가 있다면 `<C-o>` 명령을 사용한다.
그리고 다시 버퍼 목록을 앞으로 진행하고 싶다면 `@:` 명령을 사용하면 된다.

마지막 Ex 명령을 `@:`으로 반복해서 문서를 쉽게 편집할 수 있지만 그 결과를 되돌리는 방법이 항상 직관적인 것은 아니다.

`:next`, `:cnext`, `:tnext` 명령 등에서도 동일한 방식으로 `<C-o>`를 사용할 수 있다.

## Tip.32 탭 키로 Ex 명령 완성하기

셸에서와 같이 프롬프트에서 명령을 자동완성할 때는 `<Tab>`을 사용한다.

Vim은 탭 자동완성을 지원할 만큼 똑똑하다. 자동완성 기능은 먼저 명령행에 입력한 내용의 맥락에 따라서 적합한 추천 목록을 생성한다.

`:col<C-d>`

`<C-d>` 명령을 누르면 Vim에서 사용할 수 있는 자동완성 목록을 확인할 수 있다.(`:h c_CTRL-D` 참고)

색상 조합(color scheme)을 변경하려고 할 때 `<C-d>` 명령을 사용하면 명령에서 사용할 수 있는 모든 항목을 확인할 수 있다.

`:colorscheme <C-d>`

입력한 명령에서 파일 경로를 인자로 인식한다면 (`:edit`, `:write`와 같은 명령), 탭 키를 눌렀을 때는 현재 작업 디렉터리에 연관된 디렉터리나 파일명으로 자동완성을 한다.

`:tag` 명령을 사용했을 때는 태그명을 자동완성으로 사용할 수 있다.

`:set`이나 `:help`명령과 함께 탭 키를 사용하면 Vim에서 사용 가능한 모든 설정과 확인할 수 있는 도움말을 자동완성으로 제공한다.

직접 Ex 명령을 만들더라도 탭 자동완성 동작을 정의하는 것이 가능하다.(`:h :command-complete` 참고)

### 일치 목록에서 선택하기

`wildmode` 설정을 변경해서 자동완성의 탭 키를 누를 때마다의 동작 방식을 수정하는 것도 가능하다. (`:h 'wildmode'` 참고)

다음과 같이 설정을 변경하면 자동완성 기능의 동작 방식이 bash 셸에서 제공하는 자동완성과 동일하게 동작한다.

```bash
# bash
set wildmode=longest,list
```

zsh 셸 동작 설정

```zsh
# zsh
set wildmenu
set wildmode=full
```

## Tip.33 명령 프롬프트에서 현재 단어 추가하기

명령행 모드를 활성화해도 Vim은 여전히 활성화된 창과 그 창에 있는 커서의 위치를 기억하고 있다.
현재 단어(또는 WORD)를 활성화 문서에서 명령 프롬프트로 바로 입력해서 시간을 절약할 수 있다

`<C-r><C-w>` 명령으로 커서 밑에 있는 단어를 복사해서 명령행 프롬프트에 삽입하는 것이 가능하다.

`cmdline-mode/loop.js`

다음 코드의 `tally` 변수의 이름을 변경하려고 한다.

1. 커서를 `tally`에 올려놓고 * 명령을 입력하면 다음에 있는 `tally`의 위치로 커서가 이동한다.
   - * 명령은 `/\<C-r><C-w>\><CR>`을 직접 입력하는 것과 결과가 동일하다.
2. `cwcounter<Esc>`
   - 내용을 `counter`으로 변경
3. `:%s//<C-r><C-w>/g`
  - `:substitute` 명령 사용
  - 커서가 위치한 곳의 단어를 명령행 프롬프트로 바로 입력할 수 있다.
  - * 명령을 사용하면 겁색 패턴을 직접 입력하지 않아도 된다.
  - `<C-r><C-w>`가 커서 밑에 있는 단어를 사용할 수 있게 한다.
  - `<C-r><C-a>`로 WORD 를 사용하는 것도 가능하다. (`:h c_CTRL-R_CTRL-W` 참고)
  - 단어와 WORD의 차이는 Tip.49

`<C-r><C-w>` 명령은 vimrc 설정을 작성할 때 알고싶은 설정 위로 커서를 이동한 후, `:help<C-r><C-w>`를 입력하면 그 설정을 위한 문서를 바로 확인할 수 있다.

## Tip.34 히스토리에서 명령 다시 호출하기

Vim은 명령행 모드에서 사용한 모든 명령을 기록한다.

다시 호출하는 방법

1. 방향키를 이용
2. 명령행 창을 이용

Vim은 명령행 모드에서 모든 활동을 히스토리로 기록한다.

1. 먼저 명령행 모드로 전환하기 위해 :을 누른다.
  - 프롬프트를 빈 상태를 둔 후 `<Up>` 방향키를 누르면 가장 최근에 실행했던 Ex 명령이 나타난다.
    - `<Up>`을 누를 때마다 히스토리에서 이전에 사용한 Ex 명령을 하나씩 가져와서 보여준다.
    - `<Down>`을 누르면 반대로 최근 히스토리를 가져온다.
2. `:help`를 입력한 뒤 방향키
  - 히스토리 중 `help`로 시작하는 Ex 명령만 걸러낸 다음에 해당하는 명령만 보여준다.

Vim의 기본 설정은 마지막 20개의 명령만 히스토리로 저장하도록 기록되어 있다.
vimrc에 다음 행을 추가해서 명령을 200개를 히스토리로 저장하자

`set history=200`

히스토리는 Vim을 종료 후 다시 실행해도 유지된다. (`:h viminfo` 참고)

Vim은 검색 히스토리와 Ex 명령의 히스토리를 구분해서 저장한다.

`/`를 누르면 검색 프롬프트가 나온다.

### 명령행 창 만나기

명령행 모드도 끼워넣기 모드처럼 기능을 조합해서 사용하는 데 유용하지만 문서를 직접 편집하기에는 편하지 않다.

간단한 루비 코드를 작성하고 내용을 수정할 때마다 `:write`, `:!ruby %` 두 가지의 명령을 계속 사용하고 있다.

두 명령을 하나의 명령으로 합치면 `:write | !ruby %`

각각 명령은 이미 히스토리에 남아 있기 때문에, 모든 명령을 직접 하나하나 입력할 필요가 없다.

합치는 방법

1. `q:`을 입력해서 명령행 창을 연다(`:h cmdwin` 참고)

열린 명령행 창에서 지금까지 저장된 명령 히스토리를 전부 활용할 수 있다.
이 명령행 창은 일반 Vim 버퍼와 같이 동작한다. k, j 를 사용해서 히스토리를 전후로 살펴볼 수 있다.
일반 버퍼처럼 Vim의 검색 기능을 사용해서 명령을 검색하는 것도 가능하다.
이 히스토리 목록에서 실행할 명령행에 커서를 둔 다음에 `<CR>`을 누르면 현재 행에 있는 Ex 명령을 실행한다.

일반 모드에서 사용했던 모든 모션을 이 명령행 창에서 탐색할 때 활용할 수 있다
이 창 내에서 비주얼 모드를 사용하거나 끼워넣기 모드로 전환할 수 있다.
명령행의 히스토리를 제공하는 명령행 창에서 Ex 명령을 사용하는 것도 가능하다

명령행 모드에서 `<C-f>` 를 입력하는 것으로 명령행을 명령행 창으로 전환할 수 있다.

- `q/`: 검색 히스토리 명령행 창 열기
- `q:`: Ex 명령 히스토리 명령행 창 열기
- `<C-f>`: 명령행 모드에서 명령행 창으로 전환하기

## Tip.35 셸에서 명령 실행하기

Vim을 벗어나지 않고 간단하게 외부 프로그램을 실행할 수 있다.

터미널에서 Vim을 사용할 때 강력하게 활용할 수 있는 기능을 살펴본다.

### 셸에서 프로그램 실행하기

명령행 모드에서 외부 프로그램을 실행하려면 셸에서 사용하는 명령 앞에 느낌표를 붙여서 입력한다. (`:h :!` 참고)

`:!ls`

`:ls`는 버퍼에 열려 있는 항목 목록을 보여준다.

Vim의 명령행에서 % 기호는 현재 파일명을 의미한다. (`:h cmdline-special` 참고)

루비 파일을 작업하고 있을 때, 이 파일을 실행 -> `:!ruby %`

Vim은 명령에서 현재 파일의 경로나 확장자, 파일명을 입력하지 않고 쉽게 사용할 수 있도록 파일명 변경자(modifier)를 제공한다.(`:h filename-modifiers` 참고)

`:!{명령}` 문법은 명령하나만 실행하기에는 적합하다.

셸에서 여러 명령을 사용하고 싶을 때 `:shell` 명령으로 인터랙티브 셸을 시작할 수 있다. (`:h :shell` 참고)

```
:shell
$ pwd
$ ls
$ exit
```

### 표준 입출력을 버퍼에서 활용하기

`:!{명령}` 문법을 사용하면 `{명령}`의 결과를 Vim에서 출력한다.

- 출력하는 내용이 짧거나, 결과가 없을 때 큰 불편 없 이 유용하게 사용 가능
- 명령되는 내용이 많으면 사용하기에 번거로움

`:read !{명령}`

- `{명령}`의 결과를 현재 버퍼에 입력한다. (`:h :read!` 참고)
- 표준 출력이 버퍼에 바로 입력된다.

`:write !{명령}`

- 버퍼에 있는 내용을 표준 입력으로 사용해서 `{명령}`에 전달할 수 있다. (`:h :write_c` 참고)

느낌표는 명령행의 위치에 따라 의미가 달라진다

- `:write !sh`
- `:write ! sh`
  - 버퍼에 있는 내용을 표준 입력으로 외부 sh 명령을 실행한다.
- `:write! sh`
  - 버퍼의 내용을 sh라는 파일에 작성하는 명령이다.
  - 느낌표는 이미 존재하는 파일이 있다면 그 내용을 덮어쓰라는 의미
- 명령과 느낌표 기호를 조합해서 사용할 때 유의해야 한다

### 외부 명령을 사용해서 버퍼 내용 거르기

`:!{명령}` 명령에 범위를 지정해서 사용하면 뜻이 달라진다.

- `[범위]`로 행을 지정
  - 해당하는 행을 `{명령}`의 표준 입력으로 사용한다.
  - 그 명령의 표준 출력을 버퍼의 `[범위]`에 덮어쓴다.
- `[범위]`를 `{명령}`에 사용하면 필요한 자료만 걸러낼 수 있다.
  - `:h :range!` 참고

Vim은 걸러내는 작업(필터, filter)를 '표준 입력으로 문서를 받아 특정 방식으로 변경한 후에 표준 출력으로 되돌려 보내는 프로그램'으로 정의한다.

외부 sort 명령 사용 예시

`cmdline-mode/emails.csv`

`sort` 명령을 사용

* `-t','` 옵션: 쉼표로 분리된 필드를 사용하고 있다는 점을 알림
* `-k2` 옵션: 정렬하려는 필드가 두 번째 열임을 알림
* `sort`를 호출할 때, 첫 행은 재정렬할 대상이 아니기 때문에 `sort`를 호출할 때는 범위를 `:2,$`로 지정해 첫 행을 제외한다.

`:2,$!sort -t',' -k2`

`!{모션}` 오퍼레이터 명령을 사용하면 명령행 모드로 진입하게 되는데, `{모션}`에 해당하는 범위를 바로 사용할 수 있도록 범위를 미리 입력해준다. (`:h !` 참고)

### 토론

셸의 외부 명령을 호출할 때 유용하게 사용할 수 있는 명령 요약

* `:shell`: 셸을 시작함(exit를 입력하면 다시 Vim으로 돌아감)
* `:!{명령}`: 셸에서 {명령}을 실행함
* `:read !{명령}`: 셸에서 {명령}을 실행한 후, 표준 출력을 커서 아래로 추가함
* `:[범위]write !{명령}`: 셸에서 [범위]의 내용을 표준 입력으로 사용해 {명령}을 실행함.
* `:[범위]!{필터}`: 지정한 [범위]를 외부 프로그램 {필터}를 통해서 걸러냄

Vim에서 특별하게 다뤄지는 몇 가지 명령이 있다.

* `make`, `grep`과 같은 명령은 Vim 내부에서도 쉽게 사용할 수 있도록 래퍼(wrapper) 명령을 제공한다.
* Vim 내부에서 외부 셸 명령을 쉽게 사용할 수 있을 뿐만 아니라 그 명령으로 출력된 결과를 퀵픽스 목록으로 저장할 수 있다.

## Tip.36 배치를 사용해서 여러 Ex 명령 구동하기

일련의 Ex 명령을 실행할 때, 이 작업을 스크립트로 작성하면 작업량을 줄일 수 있다.

`cmdline-mode/vimcasts/episodes-1.html`

`cmdline-mode/vimcasts-episodes-1.txt`

### Ex 명령 하나씩 실행하기

`:substitute` 명령을 한 번 이용해서 변환하는 것도 가능하다.
하지만 여러 단계로 나눠서 처리하는 것이 바람직하다.

* `:g/href/j/`
* `:v/href/d`
* `:%norm A: http://vimcasts.org`
* `:%norm yi"$p`
* `:%s/\v^[^/>]}\>\s//g`

### Ex 명령을 스크립트로 작성하고 활용하기

`batch.vim`으로 저장. `.vim` 확장자를 사용하면 Vim을 위한 스크립트 파일로 인식되고, Vim 스크립트 문법에 따라서 문법 강조(syntax highlight)가 적용된다.

명령을 스크립트 파일로 작성할 때는 접두어로 `:` 문자를 사용하지 않아도 된다.

스크립트로 Ex 명령을 작성하는 경우에는 긴 이름을 그대로 사용하는 방식이 바람직하다. (가독성)

`cmdline-mode/batch.vim`

```vim
global/href/join
vglobal/href/delete
%normal A: http://vimcasts.org
%normal yi"$p
%substitute\/V^[^\>]+\>\s//g
```

`batch.vim` 스크립트 파일을 `:source` 명령으로 사용할 수 있다. (`:h source` 참고)

`:source` 명령은 일반적으로 vimrc 파일을 다시 불러와 실행 도중에 설정을 갱신하게 될 때 자주 사용하는 명령이다.

```sh
$ pwd
$ ls *.vim
$ vim vimcasts/episodes-1.html
```

`:source batch.vim`

### 여러 파일에서 스크립트 실행하기

Ex 명령을 파일로 만들어 저장하는 일은 일련의 Ex 명령을 반복적으로 사용해야 할 일이 있는 경우에 유용하다.


```sh
$ pwd
$ ls vimcasts
$ vim vimcasts/*.html
```

와일드카드(*)를 이용해서 Vim을 구동하면, 인자로 사용한 패턴과 일치한 모든 파일이 열린다.

```vimrc
:args
:first
:source batch.vim
:next
:source batch.vim
```

`:argdo` 명령을 이용하면 더 쉽게 사용할 수 있다. (`:h :argdo` 참고)

`:argdo source batch.vim`
