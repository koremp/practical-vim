# 7장 파일 열기와 저장하기

- [7장 파일 열기와 저장하기](#7장-파일-열기와-저장하기)
  - [Tip.42 파일 경로와 :edit 명령으로 파일 열기](#tip42-파일-경로와-edit-명령으로-파일-열기)
    - [현재 작업 디렉터리에서 상대 경로로 파일 열기](#현재-작업-디렉터리에서-상대-경로로-파일-열기)
    - [활성 파일 디렉터리에서 상대 경로로 파일 열기](#활성-파일-디렉터리에서-상대-경로로-파일-열기)
      - [활성 파일 디렉터리를 위한 확장](#활성-파일-디렉터리를-위한-확장)
  - [Tip.43 파일명과 :find 명령으로 파일 열기](#tip43-파일명과-find-명령으로-파일-열기)
    - [준비](#준비)
    - ['path' 설정하기](#path-설정하기)
      - [rails.vim으로 경로 관리하기](#railsvim으로-경로-관리하기)
    - [:find를 사용해서 파일명으로 파일 열기](#find를-사용해서-파일명으로-파일-열기)
  - [Tip.44 newtr로 파일 시스템 탐색하기](#tip44-newtr로-파일-시스템-탐색하기)
    - [준비](#준비-1)
    - [Vim 자체 파일 탐색기 netrw](#vim-자체-파일-탐색기-netrw)
    - [파일 탐색기 열기](#파일-탐색기-열기)
    - [분리 창에서 작업하기](#분리-창에서-작업하기)
    - [netrw 더 활용하기](#netrw-더-활용하기)
  - [Tip.45 존재하지 않는 디렉터리에 파일 저장하기](#tip45-존재하지-않는-디렉터리에-파일-저장하기)
  - [Tip.46 관리자 권한으로 파일 저장하기](#tip46-관리자-권한으로-파일-저장하기)

## Tip.42 파일 경로와 :edit 명령으로 파일 열기

Vim에서는 `:edit` 명령으로 열 수 있으며, 이 명령으로 파일을 열 때는 파일의 절대 경로와 상대 경로 모두 사용할 수 있다.

### 현재 작업 디렉터리에서 상대 경로로 파일 열기

Vim에는 배시  셸이나 다른 셸과 같이 작업 디렉터리가 존재한다.
Vim의 작업 디렉터리는 셸에서 Vim을 구동하는 그 시점의 작업 경로를 그대로 사용한다.

`:pwd` Ex 명령 - 현재 작업 경로를 확인하기 위한 명령
배시 셸에서 사용할 수 있는 `pwd` 명령과 동일하게 '작업 디렉터리 출력하기'(print working directory)를 의미한다.

`:edit {파일}` 명령은 상대 경로로도 파일을 열 수 있다. 이 상대 경로는 위에서 확인한 작업 디렉터리를 기준으로 동작한다.

`:edit lib/framework.js`

`:edit app/controllers/Navigation.js`

파일 경로를 입력할 때도 탭 키를 눌러 자동완성을 사용하면 경로를 손쉽게 입력할 수 있다.
`Navigation.js` 파일을 열라고 한다면 간단히 `:edit a<Tab>c<Tab>N<Tab>`을 입력하면 된다.

### 활성 파일 디렉터리에서 상대 경로로 파일 열기

`app/controller/Navigation.js` 파일을 편집하다가 동일한 경로에 있는 `Main.js` 파일을 편집하려고 한다.

`%` 기호는 현재 활성 버퍼의 파일 경로를 의미한다. (`:h cmdline-special` 참고)
`%`를 입력하고 `<Tab>`을 누르면 기호가 현재 활성 버퍼의 파일 경로로 전환하는 모습을 볼 수 있다.
필요한 경로와 비슷하다.

`:edit %:h<Tab>`

`:h` 변경자는 파일 경로에서 파일명을 제거한다. (`:h ::h` 참고)
현재 파일과 동ㅎ일한 위치에 있는 다른 파일을 열 것이기 때문에 `%:h<Tab>`을 입력한다.
그러면 `%:h` 부분이 현재 파일이 위치한 파일 경로로 변환될 것이다.

`:edit app/controllers/`

이제 `Main.js`만 입력하면 해당 파일을 열 수 있다.
탭 키를 눌러서 자동완성 기능을 사용할 수도 있다.
살펴본 방법을 종합한 방법은 다음과 같다.

`:edit %:h<Tab>M<Tab><Tab>`

`%:h` 확장은 매우 유용하다.
매핑을 생성하는 것도 좋은 방법이다.
매핑을 생성하는 방법은 아래 내용을 참고하자.

#### 활성 파일 디렉터리를 위한 확장

다음 내용을 `vimrc` 파일에 추가한다.

`cnoremap <expr> %% getcmdtype() == ':' ? expand('%:h').'/'. : '%%'`

위 설정을 추가한 다음 Vim의 `:` 명령행 프롬프트에서 `%%`를 입력하면 `%:h<Tab>`을 입력한 것과 같이 현재 활성 버퍼의 경로로 현재 활성 버퍼의 경로로 확장하는 것을 확인할 수 있다.
이 매핑은 `:edit`뿐만 아니라 `:write`, `:saveas`, `:read` 등 다른 Ex 명령에서도 편리하게 사용할 수 있다.

## Tip.43 파일명과 :find 명령으로 파일 열기

`:find` 명령을 사용하면 경로 전체를 입력하지 않고 파일명만 입력해도 손쉽게 파일을 열 수 있따.
이 기능을 사용하기 위해서는 먼저 `'path'`를 설정할 수 있다.

파일을 열기 위해 `:edit` 명령과 파일 경로를 사용했다.

작업하는 프로젝트에서 파일 위치가 디렉터리 깊숙한 곳에 위치해 있는 경우라면 `:find` 명령이 존재한다.

### 준비

`files/mvc` 디렉터리를 예로 든다.

```bash
$ cd code/files/mvc
$ vim index.html
```

먼저 `:find` 명령을 사용하면 다음과 같이 된다.

```vim
-> :find Main.js
< 345: path에서 "Main.js" 파일을 찾을 수 없습니다.
```

### 'path' 설정하기

`'path'` 항목은 Vim에서 `:find` 명령을 사용할 때, 어느 경로에서 파일을 찾아야하는지 알려주는 설정 값이다.(`:h 'path'` 참고)
위 예시에서는 `app/controllers`와 `app/view` 디렉터리를 찾아보도록 설정해야 한다.
이 두 경로를 추가하려면 `'path'` 항목에 다음처럼 값을 설정하면 된다.

`:set path+=app/--`

`--` 와일드카드는 `app` 아래 있는 모든 디렉터리를 찾는다.
`'path'` 설정에서 사용하는 `-`와 `--`와는 의미가 조금 다르다. (`:h file-searching` 참고)
이 와일드카드는 셸이 아니라 Vim이 처리하는 방식으로 동작한다.

#### rails.vim으로 경로 관리하기

`rails.vim` 플러그인은 `'path'`에 프로젝트의 모든 디렉터리를 자동으로 설정한다.
플러그인을 설치하면 `'path'` 설정을 따로 걱정하지 않아도 바로 `:find` 명령을 사용할 수 있다는 뜻이다.

### :find를 사용해서 파일명으로 파일 열기

`'path'`를 설정했기 때문에 `:find` 명령과 파일명만 입력하면 디렉터리 내에서 파일을 찾아 열 수 있다.
`app/controllers/Navigation.js` 파일을 열려면 다음처럼 입력하면 된다.

`:find Navigation.js`

`<Tab>`을 눌러 파일명을 자동완성할 수 있다.
`:find nav<Tab>`을 입력하면 나머지 파일명을 자동으로 완성해서 엔터키만 누르면 된다.

중복된 파일명이 있는 경우에는 `Main.js` 파일이 `app/controllers`, `app/views` 디렉터리에 각각 있다.

`:find Main.js<Tab>`

탭 키를 누르면 첫 번째로 찾은 파일의 전체 경로인 `./app/controllers/Main.js`가 나타난다.
다시 탭 키를 누르면 두 번째로 찾은 파일을 보여주는데 이 경우에는 `./app/views/Main.js`를 띄운다.
이제 엔터 키를 누르면 현재 표시되는 파일이 열린다.
탭 키를 누르지 않은 상태에서 `<CR>`을 눌렀다면 가장 먼저 찾은 파일을 열게 된다.

`'wildmode'` 설정이 기본값인 `full`로 설정되어 있지 않다면 여기에서 사용하는 탭-완성 동작이 조금 다를 수 있다.

## Tip.44 newtr로 파일 시스템 탐색하기

Vim에서는 디렉터리의 내용도 확인할 수 있따.
Vim에 포함되어 있는 `netrw` 플러그인을 이용하면 파일 시스템을 탐색할 수 있다.

### 준비

`netrw` 플러그인은 Vim과 함께 표준으로 제공하기 때문에 플러그인을 사용하도록 설정하면 별도로 설치할 필요 없이 바로 사용할 수 있다.
다음 설정은 `vimrc` 파일에 추가해보자.

```vim
# essential.vim
set nocompatible
filetype plugin on
```

### Vim 자체 파일 탐색기 netrw

Vim을 실행하면서 파일 경로 대신에 디렉터리 경로를 사용할 수 있따.
디렉터리 경로를 사용해서 Vim을 열면 경로를 인식해서 netrw 플러그인으로 파일 탐색기 창을 열게 된다.

```bash
$ cd code/file/mvc
$ ls
<app app.js index.html lib>
$ vim .
```

파일 탐색기 창에서도 일반 Vim 버퍼와 같이 `k`, `j`를 사용해서 커서를 위아래로 이동할 수 있다.
`<Cr>`을 입력하면 커서 밑에 있는 항목이 여린다.
커서가 디렉터리에 위치했다면 Vim은 탐색기 창을 해당 디렉터리의 내용으로 전환한다.
커서가 파일명에 놓인 경우에는 해당 파일을 현재 창의 버퍼로 불러와서 파일 탐색기를 대체한다.
부모 디렉터리로 이동하려면 `-`를 누르면 된다.
또는 `..`항목으로 이동해서 `<CR>`을 누른다.

일반 Vim버퍼에서 사용할 수 있는 모든 모션을 사용할 수 있다.
`index.html` 파일을 열고 싶다면 `/html<CR>` 검색 명령을 사용해서 파일명 위에 커서를 바로 이동시킬 수 있다.

### 파일 탐색기 열기

디렉터리명을 `{경로}` 인자로 사용해서 `:edit {경로}` 명령을 사용하면 해당 디렉터리를 파일 탐색기로 열게 된다.
점 기호는 현재 작업 디렉터리를 의미하므로 현재 프로젝트를 파일 탐색기로 열려면 `:edit .` 명령을 사용할 수 있다.

현재 버퍼에 열려 있는 파일의 경로를 파일 탐색기로 열려면 `:edit %:h` 명령을 사용한다.
`netwr` 플러그인은 이 기능을 더 편리하게 사용핤 수 있돍 `:Explore` 명령을 제공한다.

이 두 명령은 축약 명령이 있다.

- `:edit .` -> `:e.`
  - 파일 탐색기로 현재 작업 디렉터리 열기
  - `:edit {파일 또는 경로명}`은 명령과 경로 사이에 띄었 ㅡ기가 있어야 한다.
  - `:e.` 명령은 명령과 경로 사이에 빈칸이 없어도 동작한다.
- `:Explore` -> `:E`
  - 파일 탐색기로 현재 활성 버퍼의 디렉터리 열기

### 분리 창에서 작업하기

### netrw 더 활용하기

- 새로운 파일을 생성
  - `:h netrw-%`
- 새로운 디렉터리를 생성
  - `:h netrw-d`
- 기존 파일명을 수정
  - `:h netrw-rename`
- 파일을 제거하는 기능
  - `:h netrw-del`

netrw 플러그인은 네트워크를 통해 다른 곳에 있는 파일을 읽고 작성하는 기능도 제공한다.
scp, ftp, curl, weget 등 시스템에서 사용 가능한 수많은 프로토콜을 활용할 수 있다. (`:h netrw-ref` 참고)

## Tip.45 존재하지 않는 디렉터리에 파일 저장하기

Vim은 편집한 버퍼를 존재하지 않는 디렉터리에 저장하는 기능을 제공한다.

`:edit {파일}` 명령은 존재하지 않는 파일이더라도 새로운 빈 버퍼를 제공한다.

`<C-g>` 명령은 현재 파일의 파일명과 상태를 출력한다. (`:h ctrl-G`)
`<C-g>` 를 누르면 버퍼가 새 파일로 표시되는 것을 확인할 수 있다.

`:write` 명령을 실행하면 Vim은 현재 버퍼 내용을 사용해서 지정한 파일 경로에 새로운 파일을 작성한다.

`:edit {파일}`을 실행할 때, 디렉터리가 존재하지 않다면 새 디렉터리로 표시한다.
존재하지 않는 디렉터리 경로에 버퍼를 저장하려고 하면 오류가 난다.
외부 mkdir 프로그램을 호출하는 방법으로 해결할 수 있다.
`-p` 플래그는 mkdir 명령에서 사용한 경로에 없는 디렉터리가 ㄴ다면 생성하도록 하는 설정이다.:w

```vim
:!mkdir -p %:h
:write
```

## Tip.46 관리자 권한으로 파일 저장하기

`/etc/hosts/` 파일은 root가 소유하고 있다.

파일의 현재 상태를 확인하는 `<C-g>` 명령을 실행하면 `[읽기 전용(readonly)]`으로 표시된다.

`Go` 명령으로 파일 끝에 빈 행을 추가한다.

`:write` -> readonly

`:write!`
`/etc/hosts` 파일을 drew가 실행해서 사용할 권한이 없다.

`:w !sudo tee % > /dev/null`

* 이 명령을 입력하면 Vim은 drew의 비밀번호를 입력하고, 파일이 변경된다는 점을 경고하며 `l`(load)을 눌러 다시 파일로 불러온다.
* `:write !{명령}`은 버퍼에 있는 ㄴ내용을 `{명령}`으로 호출한 외부 프로그램에서 이용할 수 있도록 표준 입력으로 전송한다. (`:h write_c` 참고)
* Vim은 drew 사용자 권한으로 사용하고 있지만, 외부 프로세스는 관리자 권한으로 실행하도록 요청할 수 있다.
  * `tee` 유틸리티를 실행했다.
* Vim 명령행에서 `%` 기호는 현재 버퍼에 열려있는 파일 경로를 의미한다. (`:h $_% 참고`)
  * 여기서 사용한 `%` 기호는 `/etc/hosts`에 해당한다.
* 위 명령은 최종적으로 `tee /etc/hosts > /dev/null` 명령을 실행한다.
  * 이 명령은 버퍼의 내용을 표준 입력으로 받아서 그 결과를 `/etc/hosts` 파일의 내용으로 덮어쓴다.

외부 프로그램이 파일을 변경하면 Vim은 그 변경을 감지한다.
버퍼를 생성할 때의 파일 내용과 실제 파일 내용이 일치하지 않는다면 현재 버퍼의 변경 내역을 유지할지, 디스크에서 내용이 변경된 파일을 다시 불러올지 프롬프트를 사용해서 물어본다.
